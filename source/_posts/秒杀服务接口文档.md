### #APP

#### 秒杀时间轴

##### 接口描述

| 接口名称 | timeLine           |
| -------- | ------------------ |
| 包名     | seckill            |
| 访问路径 | seckill/timeLine   |
| 接口描述 | 返回秒杀活动时间线 |

##### 请求参数

无

##### 响应结果

| 序号 | 英文名称     | 中文名称     | 类型    | 是否为空 | 备注 |
| ---- | ------------ | ------------ | ------- | -------- | ---- |
| 1    | timePoint    | 时间点       | String  | N        |      |
| 2    | isInProgress | 是否在进行中 | boolean | N        |      |

##### 报文

```json
[
    {
        "timePoint": "10:00",
        "isInProgress": true
    },
    {
        "timePoint": "12:00",
        "isInProgress": false
    },
    {
        "timePoint": "14:00",
        "isInProgress": false
    },
    {
        "timePoint": "16:00",
        "isInProgress": false
    },
    {
        "timePoint": "18:00",
        "isInProgress": false
    }
]
```



##### 接口实现

1. 查询字典表中配置的秒杀时间节点

2. 获取当前系统时间判断当前时间处于哪个时间轴点上

3. 去除过时的时间节点

#### 系统对时接口

##### 接口描述

| 接口名称 | systemTime         |
| -------- | ------------------ |
| 包名     | seckill            |
| 访问路径 | seckill/systemTime |
| 接口描述 | 返回当前服务器时间 |

##### 请求参数

无

##### 响应结果

| 序号 | 英文名称   | 中文名称       | 类型   | 是否为空 | 备注                                  |
| ---- | ---------- | -------------- | ------ | -------- | ------------------------------------- |
| 1    | systemTime | 服务器系统时间 | String | N        | 格式精确到毫秒yyyy-MM-dd HH:mm:ss SSS |

##### 报文

```json
{
    "systemTime": "2019-12-16 14:11:23 234"
}
```



##### 接口实现

1. 获取当前服务器系统时间
2. 格式化为上述格式返回

#### 秒杀商品列表

##### 接口描述

| 接口名称 | productList       |
| -------- | ----------------- |
| 包名     | seckill           |
| 访问路径 | seckill/goodsList |
| 接口描述 | 返回秒杀商品列表  |

##### 请求参数

| 序号 | 英文名称  | 中文名称 | 类型   | 是否为空 | 备注 |
| ---- | --------- | -------- | ------ | -------- | ---- |
| 1    | timePoint | 时间点   | String | N        |      |

##### 响应结果

>  使用分页显示

| 序号 | 英文名称     | 中文名称   | 类型   | 是否为空 | 备注 |
| ---- | ------------ | ---------- | ------ | -------- | ---- |
| 1    | goodsId      | 商品Id     | String | N        |      |
| 2    | title        | 商品标题   | String | N        |      |
| 3    | pic          | 商品缩略图 | String | N        |      |
| 4    | seckillPrice | 秒杀价     | String | N        |      |
| 5    | goodsPrice   | 原始价     | String | N        |      |
| 6    | surplusStock | 剩余库存   | int    | N        | 暂定 |
| 7    | stock        | 总库存     | int    | N        | 暂定 |
| 8    | progress     | 已售占比   | String | N        |      |

##### 报文

```json
[
    {
      	"goodsId": "201909060429",
        "title": "玛娜（MANA）水立方胶原喷雾150ml",
        "pic": "http://jscloud-shop.oss-cn-shanghai.aliyuncs.com/201909/37818d665f0e6ff5b6b0c477d13b829a.JPEG",
        "seckillPrice": 9.9,
        "goodsPrice": 100,
        "progress": "24%"
    }
]
```



##### 接口实现

1. 根据时间点获取商品列表（Redis）

   如果Redis中不存在，查询数据库中的商品并缓存至redis中

2. 根据总库存和剩余库存计算已售占比   已售占比 = (总库存stock-剩余库存surplusStock)/(总库存stock*100%)

#### 秒杀商品详情

##### 接口描述

| 接口名称 | goodsDetail          |
| -------- | -------------------- |
| 包名     | seckill              |
| 访问路径 | seckill/goodsDetail  |
| 接口描述 | 返回秒杀商品详情信息 |

##### 请求参数

| 序号 | 英文名称 | 中文名称 | 类型   | 是否为空 | 备注 |
| ---- | -------- | -------- | ------ | -------- | ---- |
| 1    | goodsId  | 商品编号 | String | N        |      |

##### 响应结果

| 序号 | 英文名称          | 中文名称                     | 类型   | 是否为空 | 备注 |
| ---- | ----------------- | ---------------------------- | ------ | -------- | ---- |
| 1    | goodsId           | 商品Id                       | String | N        |      |
| 2    | title             | 商品标题                     | String | N        |      |
| 3    | smallImages       | 商品主图列表                 | Array  | N        |      |
| 4    | seckillPrice      | 秒杀价                       | String | N        |      |
| 5    | goodsPrice        | 原始价                       | String | N        |      |
| 8    | progress          | 已售占比                     | String | N        |      |
| 9    | detailPics        | 图文详情图                   | Array  | N        |      |
| 10   | isFifteenExchange | 是否支持15天换货（Y/N）      | String | N        |      |
| 11   | isWeekReturn      | 是否支持7天无理由退货（Y/N） | String | N        |      |
| 12   | itemGetCoins      | 单品返派币                   | String | N        |      |
| 13   | itemGetPoints     | 单品返积分                   | String | N        |      |
| 14   | itemSpec          | 产品规格                     | String | N        |      |
| 15   | limited           | 商品单次限购数量             | int    | N        |      |
| 16   | suitableDesc      | 适用说明                     | String | N        |      |

##### 报文

```json

```

##### 接口实现

1. 根据商品Id查询商品详细信息（Redis）

#### 下单接口

##### 接口描述

| 接口名称 | buy                  |
| -------- | -------------------- |
| 包名     | seckill              |
| 访问路径 | seckill/buy          |
| 接口描述 | 返回秒杀商品详情信息 |

##### 请求参数

| 序号 | 英文名称 | 中文名称 | 类型   | 是否为空 | 备注 |
| ---- | -------- | -------- | ------ | -------- | ---- |
| 1    | goodsId  | 商品编号 | String | N        |      |

##### 响应结果

| 序号 | 英文名称 | 中文名称 | 类型   | 是否为空 | 备注 |
| ---- | -------- | -------- | ------ | -------- | ---- |
| 1    | orderNo  | 订单编号 | String | N        |      |

##### 报文

```json

```

##### 接口实现

1. 根据商品Id查询商品库存（Redis）
2. 校验库存数量
3. 如果库存充足:扣减库存（使用分布式锁控制并发情况）
4. 根据商品Id查询商品详细信息
5. 创建订单
6. 缓存订单至Redis
7. 返回订单号

#### 结果查询接口

##### 接口描述

| 接口名称 | buyResult          |
| -------- | ------------------ |
| 包名     | seckill            |
| 访问路径 | seckill/buyResult  |
| 接口描述 | 返回当前服务器时间 |

##### 请求参数

| 序号 | 英文名称   | 中文名称       | 类型   | 是否为空 | 备注 |
| ---- | ---------- | -------------- | ------ | -------- | ---- |
| 1    | systemTime | 服务器系统时间 | String | N        |      |

##### 响应结果

| 序号 | 英文名称 | 中文名称       | 类型   | 是否为空 | 备注 |
| ---- | -------- | -------------- | ------ | -------- | ---- |
| 1    | status   | 服务器系统时间 | String | N        |      |
| 2    | desc     | 结果描述       | String | N        |      |
| 3    | content  | 结果内容       | String | N        |      |

##### 报文

```json

```

##### 接口实现

1. 根据商品Id查询当前用户对该商品的下单结果（Redis）

   查询hash键seckill_mem_order_result_now根据key商品id获取value

   ```java
   RedisUtil.getRedisHashMapField("seckill_mem_order_result_now","2019....");
   ```

#### 补全订单接口

##### 接口描述

| 接口名称 | orderModi         |
| -------- | ----------------- |
| 包名     | seckill           |
| 访问路径 | seckill/orderModi |
| 接口描述 | 补全订单信息      |

##### 请求参数

| 序号 | 英文名称    | 中文名称 | 类型   | 是否为空 | 备注 |
| ---- | ----------- | -------- | ------ | -------- | ---- |
| 1    | addressCode | 地址编号 | String | N        |      |
| 2    | orderId     | 订单号   | String | N        |      |

##### 响应结果

统一报文响应200/201

##### 报文

```json

```

##### 接口实现

1. 根据addressCode查询地址信息
2. 将地址信息加入订单中
3. 订单状态改为待发货

#### 获取会场口令接口

### #后台

1. 新增/修改/删除秒杀商品
2. 时间轴配置
3. 秒杀商品预处理定时任务

