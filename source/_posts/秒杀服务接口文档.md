### #APP

#### 秒杀时间轴

##### 接口描述

| 接口名称 | timeLine           |
| -------- | ------------------ |
| 包名     | seckill            |
| 访问路径 | seckill/timeLine   |
| 接口描述 | 返回秒杀活动时间线 |

##### 请求参数

无

##### 响应结果

| 序号 | 英文名称     | 中文名称     | 类型    | 是否为空 | 备注 |
| ---- | ------------ | ------------ | ------- | -------- | ---- |
| 1    | timePoint    | 时间点       | String  | N        |      |
| 2    | isInProgress | 是否在进行中 | boolean | N        |      |

##### 报文

```json
[
    {
        "timePoint": "10:00",
        "isInProgress": true
    },
    {
        "timePoint": "12:00",
        "isInProgress": false
    },
    {
        "timePoint": "14:00",
        "isInProgress": false
    },
    {
        "timePoint": "16:00",
        "isInProgress": false
    },
    {
        "timePoint": "18:00",
        "isInProgress": false
    }
]
```



##### 接口实现

1. 查询字典表中配置的秒杀时间节点

2. 获取当前系统时间判断当前时间处于哪个时间轴点上

3. 去除过时的时间节点

#### 系统对时接口

##### 接口描述

| 接口名称 | systemTime         |
| -------- | ------------------ |
| 包名     | seckill            |
| 访问路径 | seckill/systemTime |
| 接口描述 | 返回当前服务器时间 |

##### 请求参数

无

##### 响应结果

| 序号 | 英文名称   | 中文名称       | 类型   | 是否为空 | 备注                                  |
| ---- | ---------- | -------------- | ------ | -------- | ------------------------------------- |
| 1    | systemTime | 服务器系统时间 | String | N        | 格式精确到毫秒yyyy-MM-dd HH:mm:ss SSS |

##### 报文

```json
{
    "systemTime": "2019-12-16 14:11:23 234"
}
```



##### 接口实现

1. 获取当前服务器系统时间
2. 格式化为上述格式返回

#### 秒杀活动列表查询

##### 接口描述

| 接口名称 | seckillList         |
| -------- | ------------------- |
| 包名     | seckill             |
| 访问路径 | seckill/seckillList |
| 接口描述 | 返回秒杀活动列表    |

##### 请求参数

无

##### 响应结果

>  使用分页显示

| 序号 | 英文名称     | 中文名称   | 类型   | 是否为空 | 备注 |
| ---- | ------------ | ---------- | ------ | -------- | ---- |
| 1    | skTitle | 活动名称     | String | N        |      |
| 2    | skImgUrl | 活动主图   | String | N        |      |
| 3    | skDesc    | 活动描述 | String | N        |      |
| 4    | skTimeDesc | 活动剩余时间    | String | N        |      |
| 5 | skPinCodeFlag | 是否需要口令 | String | N | |
| 6 | skItemScope | 产品范围 | String | N | |

##### 报文

```json

```



##### 接口实现

1. 查询状态为Y且当前时间在活动范围内的所有活动


#### 秒杀商品列表

##### 接口描述

| 接口名称 | itemList         |
| -------- | ---------------- |
| 包名     | seckill          |
| 访问路径 | seckill/itemList |
| 接口描述 | 返回秒杀商品列表 |

##### 请求参数

| 序号 | 英文名称  | 中文名称 | 类型   | 是否为空 | 备注 |
| ---- | --------- | -------- | ------ | -------- | ---- |
| 1    | timePoint | 时间点   | String | N        |      |
| 2    | skNo      | 活动编号 | String | N        |      |

##### 响应结果

>  使用分页显示

| 序号 | 英文名称      | 中文名称   | 类型   | 是否为空 | 备注 |
| ---- | ------------- | ---------- | ------ | -------- | ---- |
| 1    | itemNo        | 商品编号   | String | N        |      |
| 2    | title         | 商品标题   | String | N        |      |
| 3    | pic           | 商品缩略图 | String | N        |      |
| 4    | seckillPrice  | 秒杀价     | String | N        |      |
| 5    | itemPrice     | 原始价     | String | N        |      |
| 6    | itemShortDesc | 商品描述   | String | N        |      |
| 6    | surplusStock  | 剩余库存   | int    | N        | 暂定 |
| 8    | stock         | 总库存     | int    | N        | 暂定 |
| 9    | progress      | 已售占比   | String | N        |      |

##### 报文

```json
[
    {
      	"goodsId": "201909060429",
        "title": "玛娜（MANA）水立方胶原喷雾150ml",
        "pic": "http://jscloud-shop.oss-cn-shanghai.aliyuncs.com/201909/37818d665f0e6ff5b6b0c477d13b829a.JPEG",
        "seckillPrice": 9.9,
        "goodsPrice": 100,
        "progress": "24%"
    }
]
```



##### 接口实现

1. 根据活动编码获取商品列表（Redis）

   如果Redis中不存在，查询数据库中的商品并缓存至redis中

2. 根据总库存和剩余库存计算已售占比   已售占比 = (总库存stock-剩余库存surplusStock)/(总库存stock*100%)

#### 秒杀商品详情

##### 接口描述

| 接口名称 | itemDetail           |
| -------- | -------------------- |
| 包名     | seckill              |
| 访问路径 | seckill/itemDetail   |
| 接口描述 | 返回秒杀商品详情信息 |

##### 请求参数

| 序号 | 英文名称 | 中文名称     | 类型   | 是否为空 | 备注 |
| ---- | -------- | ------------ | ------ | -------- | ---- |
| 1    | itemNo   | 商品编号     | String | N        |      |
| 2    | skNo     | 秒杀活动编号 | String | N        |      |

##### 响应结果

| 序号 | 英文名称          | 中文名称                     | 类型   | 是否为空 | 备注 |
| ---- | ----------------- | ---------------------------- | ------ | -------- | ---- |
| 1    | itemNo            | 商品编号                     | String | N        |      |
| 2    | title             | 商品标题                     | String | N        |      |
| 3    | smallImages       | 商品主图列表                 | Array  | N        |      |
| 4    | seckillPrice      | 秒杀价                       | String | N        |      |
| 5    | itemPrice         | 原始价                       | String | N        |      |
| 8    | progress          | 已售占比                     | String | N        |      |
| 9    | detailPics        | 图文详情图                   | Array  | N        |      |
| 10   | isFifteenExchange | 是否支持15天换货（Y/N）      | String | N        |      |
| 11   | isWeekReturn      | 是否支持7天无理由退货（Y/N） | String | N        |      |
| 12   | itemGetCoins      | 单品返派币                   | String | N        |      |
| 13   | itemGetPoints     | 单品返积分                   | String | N        |      |
| 14   | itemSpec          | 产品规格                     | String | N        |      |
| 15   | limited           | 商品单次限购数量             | int    | N        |      |
| 16   | suitableDesc      | 适用说明                     | String | N        |      |
| 17   | efficacyDesc      | 产品功效                     | String | N        |      |
| 18   | usageMethod       | 使用方法                     | String | N        |      |

##### 报文

```json

```

##### 接口实现

1. 根据商品Id查询商品详细信息（Redis）

   hash-Key: **seckill\_{skNo}\_item**

   filed: **itemNo:value**

   例:RedisUtil.getRedisHashMapField("seckill\_20191211xxx\_item","2019xxxxx");

#### 下单接口

##### 接口描述

| 接口名称 | buy                  |
| -------- | -------------------- |
| 包名     | seckill              |
| 访问路径 | seckill/buy          |
| 接口描述 | 返回秒杀商品详情信息 |

##### 请求参数

| 序号 | 英文名称 | 中文名称 | 类型   | 是否为空 | 备注 |
| ---- | -------- | -------- | ------ | -------- | ---- |
| 1    | goodsId  | 商品编号 | String | N        |      |

##### 响应结果

| 序号 | 英文名称 | 中文名称 | 类型   | 是否为空 | 备注 |
| ---- | -------- | -------- | ------ | -------- | ---- |
| 1    | orderNo  | 订单编号 | String | N        |      |

##### 报文

```json

```

##### 接口实现

1. 根据商品Id查询商品库存（Redis）
2. 校验库存数量
3. 如果库存充足:扣减库存（使用分布式锁控制并发情况）
4. 根据商品Id查询商品详细信息
5. 创建订单
6. 缓存订单至Redis
7. 返回订单号

#### 秒杀订单列表查询

待完成

#### 结果查询接口

##### 接口描述

| 接口名称 | buyResult         |
| -------- | ----------------- |
| 包名     | seckill           |
| 访问路径 | seckill/buyResult |
| 接口描述 | 返回订单操作结果  |

##### 请求参数

| 序号 | 英文名称 | 中文名称 | 类型   | 是否为空 | 备注 |
| ---- | -------- | -------- | ------ | -------- | ---- |
| 1    | orderNo  | 订单编号 | String | N        |      |

##### 响应结果

| 序号 | 英文名称 | 中文名称 | 类型   | 是否为空 | 备注 |
| ---- | -------- | -------- | ------ | -------- | ---- |
| 1    | status   | 结果状态 | String | N        |      |
| 2    | desc     | 结果描述 | String | N        |      |
| 3    | content  | 结果内容 | String | N        |      |

##### 报文

```json

```

##### 接口实现

1. 根据商品Id查询当前用户对该商品的下单结果（Redis）

   查询hash键seckill_mem_order_result_now根据key商品id获取value

   ```java
   RedisUtil.getRedisHashMapField("seckill_mem_order_result_now","2019....");
   ```

#### 补全订单接口

##### 接口描述

| 接口名称 | orderModi         |
| -------- | ----------------- |
| 包名     | seckill           |
| 访问路径 | seckill/orderModi |
| 接口描述 | 补全订单信息      |

##### 请求参数

| 序号 | 英文名称    | 中文名称 | 类型   | 是否为空 | 备注 |
| ---- | ----------- | -------- | ------ | -------- | ---- |
| 1    | addressCode | 地址编号 | String | N        |      |
| 2    | orderId     | 订单号   | String | N        |      |

##### 响应结果

统一报文响应200/201

##### 报文

```json

```

##### 接口实现

1. 根据addressCode查询地址信息
2. 将地址信息加入订单中
3. 订单状态改为待发货

#### 获取会场口令接口

### #后台

#### 保存秒杀活动

##### 接口描述

| 接口名称 | save             |
| -------- | ---------------- |
| 包名     | seckill          |
| 访问路径 | seckill/save     |
| 接口描述 | 保存秒杀活动接口 |

##### 请求参数

| 序号 | 英文名称        | 中文名称                       | 类型   | 是否为空 | 备注 |
| ---- | --------------- | ------------------------------ | ------ | -------- | ---- |
|      | skNo            | 活动编号                       | String | N        |      |
| 2    | skTitle         | 活动名称                       | String | N        |      |
| 3    | skDesc          | 活动描述                       | String | N        |      |
| 4    | skImgCode       | 活动主图编码                   | String | N        |      |
| 5    | skImgUrl        | 活动主图地址                   | String | N        |      |
| 6    | skBannerImgCode | 秒杀活动广告图编码             | String | N        |      |
| 7    | skBannerImgUrl  | 秒杀活动广告图地址             | String | N        |      |
| 8    | skStartTime     | 秒杀开始时间                   | String | N        |      |
| 9    | skEndTime       | 秒杀结束时间                   | String | N        |      |
| 10   | skPinCodeFlag   | 是否需要口令: N-不需要；Y-需要 | String | N        |      |
| 11   | skItemScope     | 产品范围：S-单个商品; M-多商品 | String | N        |      |

##### 响应结果

返回保存成功失败200/201

##### 报文

```json

```

##### 接口实现

1. 根据活动编号判断是新增还是修改

#### 秒杀活动详情查询

##### 接口描述

| 接口名称 | detail         |
| -------- | -------------- |
| 包名     | seckill        |
| 访问路径 | seckill/detail |
| 接口描述 | 秒杀活动详情   |

##### 请求参数

| 序号 | 英文名称 | 中文名称     | 类型   | 是否为空 | 备注 |
| ---- | -------- | ------------ | ------ | -------- | ---- |
| 1    | skCode   | 秒杀活动编码 | String | N        |      |

##### 响应结果

| 序号 | 英文名称        | 中文名称                       | 类型   | 是否为空 | 备注 |
| ---- | --------------- | ------------------------------ | ------ | -------- | ---- |
| 1    | skCode          | 活动编码                       | String | N        |      |
| 2    | skNo            | 活动编号                       | String | N        |      |
| 3    | skTitle         | 活动名称                       | String | N        |      |
| 4    | skDesc          | 活动描述                       | String | N        |      |
| 5    | skImgCode       | 活动主图编码                   | String | N        |      |
| 6    | skImgUrl        | 活动主图地址                   | String | N        |      |
| 7    | skBannerImgCode | 秒杀活动广告图编码             | String | N        |      |
| 8    | skBannerImgUrl  | 秒杀活动广告图地址             | String | N        |      |
| 9    | skStartTime     | 秒杀开始时间                   | String | N        |      |
| 10   | skEndTime       | 秒杀结束时间                   | String | N        |      |
| 11   | skPinCodeFlag   | 是否需要口令: N-不需要；Y-需要 | String | N        |      |
| 12   | skItemScope     | 产品范围：S-单个商品; M-多商品 | String | N        |      |
| 13   | createBy        | 创建人                         | String | N        |      |
| 14   | createTime      | 创建时间                       | String | N        |      |
| 15   | updateBy        | 修改人                         | String | N        |      |
| 16   | updateTime      | 修改时间                       | String | N        |      |

##### 报文

```json

```

##### 接口实现

1. 根据活动编码查询活动详情

#### 发布秒杀活动

#### 取消秒杀活动

#### 撤销秒杀活动

#### 下架秒杀活动

##### 接口描述

| 接口名称 | publish/cancel/revoke/pull           |
| -------- | ------------------------------------ |
| 包名     | seckill                              |
| 访问路径 | seckill/[publish/cancel/revoke/pull] |
| 接口描述 | 发布/取消/撤销/下架秒杀活动接口      |

##### 请求参数

| 序号 | 英文名称 | 中文名称     | 类型   | 是否为空 | 备注 |
| ---- | -------- | ------------ | ------ | -------- | ---- |
| 1    | skCode   | 秒杀活动编码 | String | N        |      |

##### 响应结果

返回删除成功失败200/201

##### 报文

```json

```

##### 接口实现

1. 调用updStatus方法

   updStatus("Y");//发布

   updStatus("C");//取消

   updStatus("K");//撤销

   updStatus("D");//下架



#### 保存秒杀活动商品

##### 接口描述

| 接口名称 | saveItem             |
| -------- | -------------------- |
| 包名     | seckill              |
| 访问路径 | seckill/saveItem     |
| 接口描述 | 保存秒杀活动商品接口 |

##### 请求参数

| 序号 | 英文名称       | 中文名称                            | 类型   | 是否为空 | 备注 |
| ---- | -------------- | ----------------------------------- | ------ | -------- | ---- |
| 1    | skItemCode     | 秒杀产品编码                        | String | N        |      |
| 2    | skCode         | 活动编码                            | String | N        |      |
| 3    | itemCode       | 产品编码                            | String | N        |      |
| 4    | itemShortDesc  | 产品简短描述                        | String | N        |      |
| 5    | itemPrice      | 秒杀产品价格，以实际价格*100存储    | String | N        |      |
| 6    | getCoins       | 返现设置-购买人，以实际金额*100存储 | String | N        |      |
| 7    | refCoins       | 返现设置-分享人, 以实际金额*100存储 | String | N        |      |
| 8    | skBannerImgUrl | 秒杀活动广告图地址                  | String | N        |      |
| 9    | skStartTime    | 秒杀开始时间                        | String | N        |      |
| 10   | skEndTime      | 秒杀结束时间                        | String | N        |      |
| 11   | skPinCodeFlag  | 是否需要口令: N-不需要；Y-需要      | String | N        |      |
| 12   | skItemScope    | 产品范围：S-单个商品; M-多商品      | String | N        |      |

##### 响应结果

返回保存成功失败200/201

##### 报文

```json

```

##### 接口实现

1. 根据秒杀产品编码判断是新增还是修改

#### 秒杀商品详情

##### 接口描述

| 接口名称 | itemDetail         |
| -------- | ------------------ |
| 包名     | seckill            |
| 访问路径 | seckill/itemDetail |
| 接口描述 | 秒杀活动商品详情   |

##### 请求参数

| 序号 | 英文名称   | 中文名称     | 类型   | 是否为空 | 备注 |
| ---- | ---------- | ------------ | ------ | -------- | ---- |
| 1    | skItemCode | 秒杀产品编码 | String | N        |      |

##### 响应结果

| 序号 | 英文名称       | 中文名称                            | 类型   | 是否为空 | 备注 |
| ---- | -------------- | ----------------------------------- | ------ | -------- | ---- |
| 1    | skItemCode     | 秒杀产品编码                        | String | N        |      |
| 2    | skCode         | 活动编码                            | String | N        |      |
| 3    | itemCode       | 产品编码                            | String | N        |      |
| 4    | itemShortDesc  | 产品简短描述                        | String | N        |      |
| 5    | itemPrice      | 秒杀产品价格，以实际价格*100存储    | String | N        |      |
| 6    | getCoins       | 返现设置-购买人，以实际金额*100存储 | String | N        |      |
| 7    | refCoins       | 返现设置-分享人, 以实际金额*100存储 | String | N        |      |
| 8    | skBannerImgUrl | 秒杀活动广告图地址                  | String | N        |      |
| 9    | skStartTime    | 秒杀开始时间                        | String | N        |      |
| 10   | skEndTime      | 秒杀结束时间                        | String | N        |      |
| 11   | skPinCodeFlag  | 是否需要口令: N-不需要；Y-需要      | String | N        |      |
| 12   | skItemScope    | 产品范围：S-单个商品; M-多商品      | String | N        |      |

##### 报文

```json

```

##### 接口实现

1. 根据秒杀产品编码查询秒杀商品详情

#### 删除秒杀活动商品

##### 接口描述

| 接口名称 | delItem              |
| -------- | -------------------- |
| 包名     | seckill              |
| 访问路径 | seckill/delItem      |
| 接口描述 | 删除秒杀活动商品接口 |

##### 请求参数

| 序号 | 英文名称   | 中文名称     | 类型   | 是否为空 | 备注 |
| ---- | ---------- | ------------ | ------ | -------- | ---- |
| 1    | skItemCode | 秒杀产品编码 | String | N        |      |
| 2    | skCode     | 秒杀活动编码 | String | N        |      |

##### 响应结果

返回删除成功失败200/201

##### 报文

```json

```

##### 接口实现

1. 根据秒杀产品编码和秒杀活动编码删除秒杀活动产品

2. 删除Redis中的产品

   ```
   RedisUtil.delRedisHashMapField("seckill_{skNo}_item","itemNo");
   ```


#### 秒杀商品预处理定时任务

2. 时间轴配置
3. 秒杀商品预处理定时任务

